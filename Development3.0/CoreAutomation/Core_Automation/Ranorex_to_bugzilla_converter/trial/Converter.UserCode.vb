'//////////////////////////////////////////////////////////////////////////////
'
' This file was automatically generated by RANOREX.
' http://www.ranorex.com
'
'//////////////////////////////////////////////////////////////////////////////

Imports System
Imports System.Collections.Generic
Imports System.Text
Imports System.Text.RegularExpressions
Imports System.Drawing
Imports System.Threading
Imports System.Windows.Forms

Imports Ranorex
Imports Ranorex.Core
Imports Ranorex.Core.Testing

Namespace trial

    Public Partial Class Converter

        ''' <summary>
        ''' This method gets called right after the recording has been started.
        ''' It can be used to execute recording specific initialization code.
        ''' </summary>
        Private Sub Init()
            ' Your recording specific initialization code goes here.
        End Sub
        
        Public Shared Sub test()
        		Dim file_path As String=InputBox("Enter the Ranorex Report File path","Bugzilla CSV converter","Enter the entire file path here..")
        		
        		Dim system_date As String=String.Format("{0:dd-MMM-yyyy H-mm-ss}", System.DateTime.Now)
            	Dim new_date As String=String.Format("{0:yyyy-MM-dd}", Date.Now)
		        Dim string1 As String="D:\Automation_Reports_Bugzilla\Ranorex"+system_date+".csv"
		        
		       	Dim xlApp As Excel.Application
		        Dim xlWorkBook As Excel.Workbook
		        Dim xlWorkSheet As Excel.Worksheet
		        Dim misValue As Object = System.Reflection.Missing.Value
		
		        xlApp = New Excel.ApplicationClass
		        xlWorkBook = xlApp.Workbooks.Add(misValue)
		        xlWorkSheet = xlWorkBook.Sheets("sheet1")
		        xlWorkSheet.Name = "bugs-"+new_date
		        Dim column_string As String="bug_id,bug_severity,priority,op_sys,assigned_to,bug_status,resolution,short_desc,changeddate,reporter_realname,reporter,qa_contact,qa_contact_realname,opendate"        
				Dim column_split() As String=column_string.Split(",")
				Dim ubcnt As Integer=column_split.GetUpperBound(0)
				For i as Integer=0 to ubcnt
		        xlWorkSheet.Cells(1,i+1) = column_split(i)
		        Next
			   	
		        ' Calling the function Continuation here
		        
				Dim array_check As String=continuation(file_path)
				Dim array_split() As String=array_check.Split("|")
				Dim ubcnt1 As Integer=array_split.GetUpperBound(0)
				For i as Integer=1 to ubcnt1
		        xlWorkSheet.Cells(i+1,8) = array_split(i)
		        Next
		        
		        Dim new_range As Excel.Range
		        Dim row_count As Integer
		        new_range=xlWorkSheet.UsedRange
		        row_count=new_range.Rows.Count
		        
		        For i as Integer=2 to row_count
		        xlWorkSheet.Cells(i,4) = "Other"
		        xlWorkSheet.Cells(i,6) = "NOT VERIFIED"
		        xlWorkSheet.Cells(i,7) = "NOTFIXED"
		        Next
		        
				
				xlWorkSheet.SaveAs(string1)
		
		        xlWorkBook.Close()
		        xlApp.Quit()
		        msgbox("File Successfully saved -"+string1)

        End Sub
        
     Public Shared Function continuation(ByVal path As String)
     	
		    Dim xlApp As Excel.Application
			Dim xlBook As Excel.Workbook
			Dim xlSheet1 As Excel.Worksheet
			Dim array_check As String=""
			Dim obj1 as Object
			Dim rng As Excel.Range, Search_strng As string
			Search_strng = "Failure"
			xlApp = CreateObject("Excel.Application")
			xlBook = xlApp.Workbooks.Open(path)
			xlSheet1 = xlBook.Worksheets(1)
			rng = xlSheet1.UsedRange
			Dim rCnt As Integer
			Dim Obj As Object
			Dim Obj2 as Object
		
				        For rCnt = 3 To rng.Rows.Count
				            	Obj = CType(rng.Cells(rCnt,41), excel.Range)
				                If obj.value=Search_strng Then
				                	Obj1 = CType(rng.Cells(rCnt,43), excel.Range)
				                	Obj2 = CType(rng.Cells(rCnt,37), excel.Range)
				                	If Obj1.value <> Nothing Then
				                	array_check=array_check+"|"+Obj1.value+" (Ref:"+Obj2.value+")"
				                	End If
				                End If
				        Next
			
			xlBook.Close()
			xlApp.Quit()
			Return(array_check)
			
        End Function

    End Class
End Namespace
